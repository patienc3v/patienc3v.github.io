<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gen.M Esports Statistics</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="styles/common.css">
  <link rel="stylesheet" href="styles/stats.css">
</head>
<body>
  <nav>
    <img src="images/gen.m.png" alt="Gen.M Esports Logo">
    <span>Gen.M Esports</span>
    <div id="menu">
      <a href="index.html">Home</a>
      <a href="news.html">News</a>
      <a href="roster.html">Roster</a>
      <a href="stats.html">Statistics</a>
      <a href="schedule.html">Schedule</a>
      <a href="videos.html">Videos</a>
    </div>
    <a href="javascript:void(0);" class="icon" onclick="javascript:toggleMenu();">
    <i class="fa fa-bars"></i>
    </a>
  </nav>

  <main>
    <section class="stats-section">
      <h2>Team Statistics</h2>
      <div id="team-stats" class="team-stats">
      </div>
    </section>

    <section class="stats-section">
      <h2>Player Statistics</h2>
      <div id="player-stats" class="player-stats">
      </div>
    </section>
  </main>

  <footer>
    <p style="text-align: center; color: #888; padding: 1rem;">&copy; 2025 GEN M Esports. All rights reserved.</p>
  </footer>

  <script>
    const menu = document.getElementById("menu");
    function toggleMenu() {
      if (menu.style.display === "block") {
        menu.style.display = "none";
      } else {
        menu.style.display = "block";
      }
    } 

    const description = {
      'numgames': "# of Games",
      'teamkda': 'Team KDA',
      'avgkda': 'Average KDA',
      'avgherodamage': "Avg. Hero Damage",
      'avghealing': "Avg. Healing",
      'avgtimeccdenemyheroes': "Avg. Time CC'ing Enemy Heroes",
      'avgtimerootingenemyheroes': "Avg. Time Rooting Enemy Heroes",
      'avgtimesilencingenemyheroes': "Avg. Time Silencing Enemy Heroes",
      'avgtimestunningenemyheroes': "Avg. Time Stunning Enemy Heroes",
      'avgtimedead': "Avg. Time Spent Dead",
      'herodamage': "Hero Damage",
      'damagetaken': 'Damage Taken',
      'siegedamage': "Siege Damage",
      'teamfightherodamage': "Teamfight Hero Dmg.",
      'teamfighthealingdone': 'Teamfight Healing',
      'teamfightdamagetaken': "Teamfight Dmg. Taken",
      'experiencecontribution': 'XP Contribution',
      'xpm': 'XP per Minute',
      'hpm': 'Healing per Minute',
      'dpm': 'Hero Dmg. per Minute',
      'timeccdenemyheroes': "Time CC'ing Enemy",
      'timerootingenemyheroes': "Time Rooting Enemy",
      'timesilencingenemyheroes': "Time Silencing Enemy",
      'timestunningenemyheroes': "Time Stunning Enemy",
      'timespentdead': 'Time Spent Dead',
      'length': 'Avg. Match Length',
      'timespentdeadpct': 'Time Spent Dead (%)'
    }

    async function fetchData() {      
      try {
        const response = await fetch("data/stats.json");
        
        if (!response.ok) {
            throw new Error('Error while retrieving the team data.');
        }

        const data = await response.json();

        Object.keys(data.team).forEach((key) => {
          const card = document.createElement("div");
          card.className = "stat-card";
          card.innerHTML = `
            <h3>${description[key.toLowerCase()] || key}</h3>
            <p>${formatValue(data.team[key], key)}</p>
          `;
          teamContainer.appendChild(card);
        });

        const playerContainer = document.getElementById("player-stats");

        Object.keys(data.players).forEach((player) => {
          const card = document.createElement("div");
          card.className = "stat-card";
          card.innerHTML = `
            <h3>${player}</h3>
          `;
          var heroList = `
              <div class="top-heroes">
          `;
          // add mostPlayed first

          for (var index = 0; index < Math.min(3, data.players[player].mostPlayed.length); index++) {
            const hero = data.players[player].mostPlayed[index];
            heroList += `
              <img src="images/heroes/${hero.toLowerCase()}.png" alt="${hero}">
            `;
          };
          card.innerHTML += `
          ${heroList}
              </div>
          `;
          Object.keys(data.players[player]).forEach((stat) => {
            if (stat !== "mostPlayed" && stat !== 'length') {
              card.innerHTML += `
                <div class="stat-row"><span>${description[stat.toLowerCase()] || stat}:</span> <span>${formatValue(data.players[player][stat], stat)}</span>
              `;
            }
          });

          card.innerHTML += `
                <div class="stat-row"><span>${description[('length')] || stat}:</span> <span>${formatValue(data.players[player]['length'], 'length')}</span>
          `;
          playerContainer.appendChild(card);
        });
      } catch (error) {
        console.error('Failed to fetch data:', error);
      } finally {
        console.log("Done");
      }
    }

    function formatValue(value, key) {
      key = key.toLowerCase();
      var time = !key.includes('pct') && (key.includes('time') || key.includes('length'));
      if (time) {
        const minutes = Math.floor(value / 60)
        const seconds = value - minutes * 60;
        let [intPart, decPart] = Number(seconds).toFixed(2).split('.');
        intPart = intPart.padStart(2, '0');
        return `${minutes}:${intPart}.${decPart}`;
      }
      var percent = key.includes('participation') || key.includes('pct');
      if (percent) {
        value *= 100.0;
      }
      var decimals = 2;
      if (key.includes('numgames')) {
        decimals = 0;
      }
      return value.toLocaleString('en-US', {minimumFractionDigits: decimals, maximumFractionDigits: decimals}) + (percent ? "%" : "");
    }

    const teamContainer = document.getElementById("team-stats");
    
    fetchData();
</script>
</body>
</html>
