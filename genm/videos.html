<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon/favicon-16x16.png">
  <link rel="manifest" href="images/favicon/site.webmanifest">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gen.M Esports Videos</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="styles/common.css">
  <link rel="stylesheet" href="styles/videos.css">
</head>
<body>
  <nav>
    <img src="images/gen.m.png" alt="Gen.M Esports Logo">
    <span>Gen.M Esports</span>
    <div id="menu">
      <a href="index.html">Home</a>
      <a href="news.html">News</a>
      <a href="roster.html">Roster</a>
      <a href="stats.html">Statistics</a>
      <a href="schedule.html">Schedule</a>
      <a href="videos.html">Videos</a>
    </div>
    <a href="javascript:void(0);" class="icon" onclick="javascript:toggleMenu();">
    <i class="fa fa-bars"></i>
    </a>
  </nav>

  <main>
    <h2>Match Videos</h2>
    <div class="video-section">
      <div class="main-video">
        <iframe id="mainVideo" src="https://www.youtube.com/embed/VIDEO_ID" allowfullscreen></iframe>
      </div>

      <div class="filters">
        <select id="seasonFilter">
          <option value="all">All Seasons</option>
        </select>
        <select id="opponentFilter">
          <option value="all">All Opponents</option>
        </select>
        <select id="typeFilter">
          <option value="all">All Types</option>
          <option value="Group Stage">Group Stage</opeion>
          <option value="Playoff">Playoff</opeion>
        </select>
      </div>

      <div class="video-list" id="videoList">
      </div>
      <div class="pagination" id="paginationControls"></div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Gen.M Esports. All rights reserved.</p>
  </footer>

  <script>
    let videos = [];
    const menu = document.getElementById("menu");

    const container = document.getElementById("videoList");
    const seasonContainer = document.getElementById("seasonFilter");

    const seasons = [];
    const opponents = [];

    const mainVideo = document.getElementById('mainVideo');
    const videoItems = Array.from(document.querySelectorAll('.video-item'));
    const seasonFilter = document.getElementById('seasonFilter');
    const opponentFilter = document.getElementById('opponentFilter');
    const typeFilter = document.getElementById('typeFilter');
    const videoList = document.getElementById('videoList');
    const paginationControls = document.getElementById('paginationControls');


    let currentPage = 1;
    const itemsPerPage = 10;

	async function fetchData() {      
      try {
        const response = await fetch("data/videos.json");
        
        if (!response.ok) {
            throw new Error('Error while retrieving the team data.');
        }

        videos = await response.json();

		} catch (error) {
			console.error('Failed to fetch data:', error);
		} finally {
			videos.forEach((video) => {
				const item = document.createElement("div");
				item.className = "video-item";
				item.setAttribute("data-id", video.video)
				item.setAttribute("data-season", video.season)
				item.setAttribute("data-opponent", video.opponent)
				item.setAttribute("data-type", video.type)
				item.innerHTML = `
					Season ${video.season} - ${video.opponent} - ${video.type}
				`;
				opponents.push(video.opponent);
				seasons.push(video.season);
				container.appendChild(item);
			});

			const seasonOptions = [...new Set(seasons)].sort((a, b) => b - a);
			const opponentOptions = [...new Set(opponents)].sort((a, b) => a.localeCompare(b));

			seasonOptions.forEach((season) => {
				const item = document.createElement("option");
				item.value = season;
				item.innerHTML = `
					${season}
				`;
				seasonContainer.appendChild(item);
			});

			opponentOptions.forEach((opponent) => {
				const item = document.createElement("option");
				item.value = opponent;
				item.innerHTML = `
					${opponent}
				`;
				opponentFilter.appendChild(item);
			});

			mainVideo.src = `https://www.youtube.com/embed/${videos[0].video}`;

			videoItems.forEach(item => {
				item.addEventListener('click', () => {
					const videoId = item.dataset.id;
					mainVideo.src = `https://www.youtube.com/embed/${videoId}`;
				});
			});

			seasonFilter.addEventListener('change', () => { currentPage = 1; applyFiltersAndPagination(); });
			opponentFilter.addEventListener('change', () => { currentPage = 1; applyFiltersAndPagination(); });
			typeFilter.addEventListener('change', () => { currentPage = 1; applyFiltersAndPagination(); });

			applyFiltersAndPagination();
		}
	}

    function toggleMenu() {
      if (menu.style.display === "block") {
        menu.style.display = "none";
      } else {
        menu.style.display = "block";
      }
    } 


    function applyFilters() {
      return videoItems.filter(item => {
        const matchesSeason = seasonFilter.value === 'all' || item.dataset.season === seasonFilter.value;
        const matchesOpponent = opponentFilter.value === 'all' || item.dataset.opponent === opponentFilter.value;
        const matchesType = typeFilter.value === 'all' || (typeFilter.value === "Group Stage" && item.dataset.type === typeFilter.value) || item.dataset.type !== "Group Stage";
        return matchesSeason && matchesOpponent && matchesType;
      });
    }

    function renderPagination(filteredItems) {
      const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
      paginationControls.innerHTML = '';

      const createBtn = (label, page, disabled = false, active = false) => {
        const btn = document.createElement('button');
        btn.textContent = label;
        if (disabled) btn.disabled = true;
        if (active) btn.classList.add('active');
        btn.addEventListener('click', () => {
          currentPage = page;
          applyFiltersAndPagination();
        });
        return btn;
      };

      paginationControls.appendChild(createBtn('First', 1, currentPage === 1));
      paginationControls.appendChild(createBtn('Previous', currentPage - 1, currentPage === 1));

      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(totalPages, startPage + 4);
      if (endPage - startPage < 4) startPage = Math.max(1, endPage - 4);

      for (let i = startPage; i <= endPage; i++) {
        paginationControls.appendChild(createBtn(i, i, false, i === currentPage));
      }

      paginationControls.appendChild(createBtn('Next', currentPage + 1, currentPage === totalPages));
      paginationControls.appendChild(createBtn('Last', totalPages, currentPage === totalPages));
    }

    function applyFiltersAndPagination() {
      const filteredItems = applyFilters();
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;

      videoItems.forEach(item => item.style.display = 'none');
      filteredItems.slice(start, end).forEach(item => item.style.display = '');

      renderPagination(filteredItems);
    }

	fetchData();
  </script>
</body>
</html>
